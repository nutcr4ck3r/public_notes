# Vim の基本的な操作：コピー・切り取り＆ペースト

Vim のコピー＆ペースト操作もまた、文字入力と同じく、
他のテキストエディタとは全く異なるものとなっています。

しかし、キーボードの`Ctrl + c`, `Ctrl + x`, `Ctrl + v`
だけでコピー・切り取り＆ペーストを行うよりも、
はるかに高速で文章編集が可能となりますので、
以下に挙げる代表的な操作だけでも習熟してみましょう。

なお、コピーした文章は、新たに別の範囲をコピー・切り取りしない限り、
何度でもペーストすることができます。

また、Vim でコピー・切り取りした文字列は、Vim の中でのみ保持されるものであるため、
クリップボードなどから利用することはできません。

クリップボードとの連携は、各種プラグインの導入の項において、あわせて説明します。

## 1. コピー＆ペースト

Vim のコピー機能には、
通常の範囲コピー、行単位のコピー及び矩形選択からのコピーが存在しますが、
矩形選択は

### 1.1. 通常の範囲コピー＆ペースト

```text
範囲コピー＆ペースト
  - 範囲選択：v
  - コピー  ：範囲選択後に y
  - ペースト（ノーマルモード時、カーソルの後に貼り付け）：p
  - ペースト（ノーマルモード時、カーソルの前に貼り付け）：P
```

ペーストの操作にある、カーソルの前／後というのは、
次のイメージで考えて下さい。

```text
# コピーした文字列（範囲選択）
＠

# 貼り付け先の文章
カーソル位置
↓
[あ]いうえお

# 後にペースト
[あ]＠いうえお

# 前にペースト
＠[あ]いうえお
```

通常のテキストエディタと異なり、
Vim は現在のカーソル位置がブロック形状で少し混乱しますが、
インサートモードに入る際の挙動を参考にして考えれば、
そこまで覚えにくくはないはずです。

### 1.2. 行単位のコピー＆ペースト

```text
単一行のコピー＆ペースト
  - １行コピー：ノーマルモード時、yy
  - ペースト（ノーマルモード時、カーソル行の下段に貼り付け）  ：p
  - ペースト（ノーマルモード時、カーソル行に挿入して貼り付け）：P
複数行のコピー＆ペースト
  - 行選択：Shift + v
  - コピー：行を選択後に y
  - ペースト（ノーマルモード時、カーソル行の下段に貼り付け）  ：p
  - ペースト（ノーマルモード時、カーソル行に挿入して貼り付け）：P
```

Vim の行コピーには、一行のみと複数行の２通りが存在しています。

特に、ノーマルモードのまま実行できる一行のみのコピー＆ペーストは、
文章の推敲で大変重宝しますので、覚えておくことをおすすめします。

なお、行ペーストを行った際の挙動は、次のイメージで考えましょう。
この際、カーソルが該当行のどの位置にあるかは、ペーストの挙動には影響しません。

```text
# コピーした行（行選択）
＠＠＠＠＠

# 貼り付け先の文章
[あ]いうえお ←カーソル位置
 か きくけこ

# 後にペースト
[あ]いうえお
 ＠ ＠＠＠＠
 か きくけこ

# 前にペースト
 ＠ ＠＠＠＠
[あ]いうえお
 か きくけこ
```

### 1.3. 矩形選択のコピー＆ペースト

```text
矩形範囲のコピー＆ペースト
  - 矩形選択：Ctrl + v
  - コピー：範囲を選択後に y
  - ペースト（ノーマルモード時、カーソル位置の後に貼り付け）：p
  - ペースト（ノーマルモード時、カーソル位置の前に貼り付け）：P
```

矩形範囲でのコピー＆ペーストは、利用頻度が少なく、
かつ以下のイメージに示したように挙動が特殊であるため、
覚えにくい場合は無理に覚える必要はありません。

ペースト時の挙動のイメージは次の通りとなります。

```text
# コピーした文章（矩形選択）
＠＠＠
＠＠＠

# 貼り付け先の文章
 あ いうえお
[か]きくけこ ←カーソル位置
 さ しすせそ
 た ちつてと

# 後に貼り付け
 あ いうえお
[か]＠＠＠きくけこ
 さ ＠＠＠しすせそ
 た ちつてと

# 前に貼り付け
あいう え お
＠＠＠[か]きくけこ
＠＠＠ さ しすせそ
たちつ て と
```

## 2. 切り取り

Vim の切り取りは、単純にペーストするための文字列を取得する以外に、
文章削除機能としても使用することができます。

これによって、インサートモードに入ってからのバックスペースキーやデリートキーよりも、
はるかに高速で文章編集を行う事ができます。

なお、切り取った文章は、コピーした文章と同じく Vim 特有のバッファに保存され、
上書きしない限り何度でも貼り付けることが可能ですが、
後述する『一文字削除』や『s キーによる削除』も同じバッファを上書きするため、
文章削除で意図しない上書きが発生しないように、ある程度は注意を払う必要があるでしょう。

### 2.1. 範囲を指定した切り取り

切り取った範囲の削除は、アンドゥ・リドゥで取り消し・やり直しが可能です。

また、ペースト操作についてはコピーの項で先述した通りです。

```text
範囲切り取り
  - 範囲選択：v
  - 切り取り：範囲選択後に d
単一行の切り取り
  - １行切り取り：ノーマルモード時、dd
複数行のコピー＆ペースト
  - 行選択：Shift + v
  - 切り取り：行を選択後に d
矩形範囲の切り取りコピー＆ペースト
  - 矩形選択：Ctrl + v
  - 切り取り：範囲を選択後に d
```

### 2.2. 一文字単位の削除

ノーマルモードで一文字だけ削除したい場合に使用します。

この操作でもペーストのためのバッファが上書きされるため、注意が必要です。

```text
カーソル位置の一文字だけ削除：x
カーソル位置の一文字を削除してインサートモードへ：s
```

### 2.3. クリップボードからのペースト

Vim は通常、クリップボードとコピーバッファが連携していないため、
ブラウザなどでコピーしたデータを`p`キーで貼り付けたりは出来ません。

したがって、Vim でクリップボードから貼り付ける場合は、
次の手順を踏む必要があります。

1. ノーマルモードで`:set paste`を入力
2. . 貼り付けたい場所にカーソルを移動
3. インサートモードに移行
4. ターミナルのメニューや右クリックからクリップボードのデータを貼り付け

Vim 本来の貼り付けではなく、
クリップボードのデータを自動で入力するようなイメージとなります。

ちなみに、最初に入力する`:set paste`は、Vim のオートインデントを無効にするコマンドです。

これを入力することで、インデントを含むコードブロックをペーストした際に、
意図しないインデントが挿入されてしまう事を防ぎます。

オートインデントを無効化しない場合にどうなるのかを試す為に、
以下のコードブロックをクリップボードにコピーし、
`:set paste`した場合としない場合で、どのような変化があるかを確認してみて下さい。

```python
# ファイルに結果を書き込み
def output_2_file(jsons):
    i = 1
    for x in jsons['results']:
        with open('result.txt', mode='a') as f:
            print('No. %s' % i, file=f)
            print('Zip code: %s' % x['zipcode'], file=f)
            print('Address: %s%s%s' %
                 (x['address1'], x['address2'], x['address3']), file=f)
            print('Ruby: %s%s%s' %
                 (x['kana1'], x['kana2'], x['kana3']), file=f)
            print('')
            i += 1
```
